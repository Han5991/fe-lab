# 3주간의 패키지 배포 삽질기
## 완벽을 포기하고 배운 것들

**발표 시간**: 30분 (Q&A 별도)
**발표자**: [이름]
**날짜**: [날짜]

---

## 슬라이드 1: 타이틀

# 3주간의 패키지 배포 삽질기
## 완벽을 포기하고 배운 것들

> 20MB 괴물을 만들고 배운 것

---

## 슬라이드 2: 시작점

### "별거 아니겠지"의 착각

> **타팀 기획자**: "저희 팀에서도 그 디자인 시스템 쓸 수 있을까요?"
>
> **나**: "별거 아니에요. NPM에 올리기만 하면 되니까
> 하루면 될 것 같은데요?"

**[3주 후...]**

---

## 슬라이드 3: 처음 세운 완벽한 계획

### 📋 나의 완벽한 TODO 리스트

```
✅ 1. 완벽한 트리쉐이킹과 미니멀한 번들 사이즈
✅ 2. 완벽한 트리쉐이킹 가능한 CSS 번들
✅ 3. 완벽한 Type 지원
✅ 4. 완벽한 배포 및 설치 문서 지원
✅ 5. 완벽한 자동 배포 시스템 구축
```

**목표**: 300KB 이하, 타입 완벽, 문서 완벽
**예상 기간**: 1-2일

---

## 슬라이드 4: 3주 후의 현실

### 💥 3주 후의 현실

**실제 결과**:
- 번들 사이즈: **20MB** (목표의 66배)
- 타입 지원: 부분적
- 문서: 육성 + 슬랙
- 배포 시스템: ✅ (이건 성공!)

> **하지만... 돌아간다!** 🎉

---

# Part 1: 포기의 여정

---

## 슬라이드 5: 섹션 타이틀

# 💔 포기의 여정

하나씩 체크박스를 지워가며...

---

## 슬라이드 6: 포기 #1 - 타이틀

## ~~✅ 1. 완벽한 트리쉐이킹과 미니멀한 번들~~

**목표**: 300KB
**현실**: 20MB

---

## 슬라이드 7: 20MB 괴물의 탄생

### 왜 20MB가 되었나?

📦 **패키지 구성**:
```
├─ 소스코드 전체 (src/)
├─ styled-system 전체
├─ node_modules 일부
└─ 모든 정적 자산 (fonts, svg 등)
```

> "소스코드를 통째로 넣어야 작동했다"

---

## 슬라이드 8: 시도했던 방법들

### 시도한 것들

**1️⃣ buildInfo로 정적 CSS 생성**
→ 동작하지 않음 (클라이언트 설정 누락)

**2️⃣ 빌드 시 필요한 CSS만 추출**
→ config 기반이라 전체 클래스 생성 실패

**3️⃣ dist 폴더만 배포**
→ 런타임 에러 발생

---

## 슬라이드 9: 타협과 결정

### 💡 타협안: "일단 돌아가게"

**최종 결정**:
```json
{
  "exports": {
    ".": "./src/index.ts"  // dist가 아닌 src!
  }
}
```

**장점**:
- ✅ Panda CSS 함수 런타임 호출 가능
- ✅ 타입 정보도 함께 제공
- ✅ 실제로 작동함!

**단점**:
- ❌ 20MB
- ❌ 설치 시간 증가

---

## 슬라이드 10: 포기 #2 - 타이틀

## ~~✅ 2. 완벽한 트리쉐이킹 가능한 CSS 번들~~

Panda CSS의 런타임 특성

---

## 슬라이드 11: Panda CSS의 한계

### 문제: Panda CSS는 런타임 생성 방식

```typescript
// 사용자 코드
import { css } from '@design-system/ui/styled-system/css';

const className = css({ color: 'red' });
// 런타임에 클래스 이름 생성!
```

**필요한 것**:
- styled-system 전체 폴더
- Panda 함수들
- 토큰 정의

---

## 슬라이드 12: CSS 충돌 문제

### 더 큰 문제: Remix + Tailwind 환경

**기존 프로젝트**:
- Tailwind CSS
- 레거시 전역 CSS (`!important` 도배)
- `@layer` 남용

**우리 디자인 시스템**:
- Mantine
- Panda CSS

> "스타일이 전부 깨졌어요" 😱

---

## 슬라이드 13: CSS Layer 해결책

### 💡 해결: CSS @layer로 우선순위 제어

```css
/* 레이어 우선순위 선언 */
@layer reset, base, tokens, recipes, utilities,
       tailwind, mantine, panda-utilities;

/* 외부 CSS를 특정 layer에 배치 */
@import '@mantine/core/styles.css' layer(mantine);

@layer tailwind {
  @tailwind base;
  @tailwind components;
  @tailwind utilities;
}
```

**결과**: `!important` 없이도 우선순위 제어 가능!

---

## 슬라이드 14: 포기 #3 - 타이틀

## ~~✅ 3. 완벽한 Type 지원~~

SVGR vs tsup의 전쟁

---

## 슬라이드 15: SVGR 문제

### 문제: tsup이 SVGR의 default export를 처리 못함

```typescript
// SVGR이 생성한 코드
import * as React from 'react';
const Icon = () => <svg>...</svg>;
export default Icon; // ← 여기서 에러!
```

```bash
Error: default export를 처리할 수 없습니다
```

---

## 슬라이드 16: 타입 생성 타협안

### 💡 타협안: 이중 빌드 시스템

```json
{
  "scripts": {
    "prebuild": "panda codegen",
    "build": "tsup && tsc --emitDeclarationOnly"
  }
}
```

- **tsup**: 번들링
- **tsc**: 타입 정의 파일 생성 (별도)

**결과**:
- ✅ 대부분의 타입 지원됨
- ❌ SVG 관련 타입은 부분 누락

---

## 슬라이드 17: 포기 #4 - 타이틀

## ~~✅ 4. 완벽한 배포 및 설치 문서~~

시간이 부족했다

---

## 슬라이드 18: 문서화 포기

### 💡 타협안: 육성 + 슬랙

**현실**:
- 시간 부족
- 우선순위 밀림
- 사용자가 한 팀뿐

**해결책**:
- 📞 직접 연락
- 💬 슬랙으로 가이드
- 👨‍💻 페어 프로그래밍

> "일단 확실한 방법부터" 😅

---

## 슬라이드 19: 성공 #5 - 타이틀

## ✅ 5. 완벽한 자동 배포 시스템 구축

이건 해냈다! 🎉

---

## 슬라이드 20: 자동 배포 성공

### ✅ 유일하게 성공한 TODO

**구축한 시스템**:
- Changeset으로 버전 관리
- GitHub Actions 자동 배포
- CHANGELOG 자동 생성
- npm 자동 퍼블리시

**겪었던 문제들**:
- ❌ npm scope 규칙 (패키지 이름 전체 변경)
- ❌ GitHub Actions 무한 재귀
- ❌ Token 권한 이슈
- ❌ 기존 워크플로우 충돌

**해결**: `paths-ignore`, 워크플로우 분리

---

# Part 2: 결론

---

## 슬라이드 21: 최종 결과

### 📊 최종 체크리스트

```
~~✅ 완벽한 트리쉐이킹~~ → 20MB로 타협
~~✅ 완벽한 CSS 번들~~ → 소스코드 배포
~~✅ 완벽한 Type 지원~~ → 부분 지원
~~✅ 완벽한 문서~~ → 육성 + 슬랙
✅ 완벽한 자동 배포 → 성공!
```

**결과**:
- ❌ 완벽한 패키지
- ✅ 팀이 쓸 수 있는 패키지

---

## 슬라이드 22: 핵심 교훈

### 💡 배운 것들

**1️⃣ 완벽보다 실행**
> "일단 돌아가게 만들고, 그 다음에 개선"

**2️⃣ 현실적 타협**
> "팀 상황에 맞는 선택이 최선의 선택"

**3️⃣ 점진적 개선**
> "한 번에 완벽할 순 없다"

**가장 중요한 교훈**:
> "별거 아닌 일은 없다"

---

## 슬라이드 23: 최적화 로드맵

### 🎯 앞으로 할 일 (점진적 개선)

**20MB → 300KB 최적화 계획**:

1. 트리쉐이킹 가능한 구조로 리팩토링
2. SVG 별도 패키지화
3. 불필요한 정적 자산 제거 (fonts, unused svg)
4. Panda buildInfo 재도전
5. 문서 자동화

> "완벽은 한 번에 오지 않는다"

---

## 슬라이드 24: 다음에는 이렇게

### 📝 체크리스트 (다음 삽질을 피하려면)

**사전 계획**:
- ☑ 패키지 이름 npm scope 규칙 확인
- ☑ CSS 프레임워크 조합 가능성 검증
- ☑ 빌드 도구 제약사항 사전 조사

**개발 단계**:
- ☑ pnpm pack으로 로컬 테스트 환경 먼저 구축
- ☑ 빌드 결과물 확인 후 다음 단계 진행

**적용 단계**:
- ☑ 실제 환경과 유사한 테스트 환경 검증
- ☑ 문제 발견 시 최소한의 타협안 먼저 찾기

**최적화**:
- ☑ 일단 돌아가게 만들기 우선
- ☑ 단계적으로 개선

---

## 슬라이드 25: 클로징

### 마지막으로

# "별거 아니라고 하지 마세요!" 🙏

**3주간의 삽질이 알려준 것**:
- 완벽한 해결책은 없다
- 팀 상황에 맞는 실용적 선택이 중요하다
- 일단 돌아가게 만들고, 점진적으로 개선한다

> 누군가는 이 발표를 보고
> "덕분에 삽질 안 하고 성공했어요!"
> 라고 말해주길 바랍니다.

**감사합니다.**

---

# 백업 슬라이드 (Q&A용)

---

## 기술 스택 상세

### 모노레포 구성
- Turborepo + pnpm workspace
- 디자인 시스템: Mantine + Panda CSS
- 빌드: tsup + tsc
- 배포: Changeset + GitHub Actions

### 사용 환경
- Remix + Tailwind CSS
- 레거시 전역 CSS

---

## 코드 예시: package.json

```json
{
  "name": "@our-org/design-system",
  "exports": {
    ".": "./src/index.ts",
    "./components/*": "./src/components/*"
  },
  "peerDependencies": {
    "@package/core": "workspace:^",
    "@package/service": "workspace:^"
  },
  "scripts": {
    "prebuild": "panda codegen",
    "build": "tsup && tsc --emitDeclarationOnly"
  }
}
```

---

## 코드 예시: CSS Layer

```css
/* 우선순위 선언 */
@layer reset, base, tokens, recipes, utilities,
       tailwind, mantine, panda-utilities;

/* Mantine을 낮은 우선순위로 */
@import '@mantine/core/styles.css' layer(mantine);

/* Tailwind도 별도 layer */
@layer tailwind {
  @tailwind base;
  @tailwind components;
  @tailwind utilities;
}
```

---

## 코드 예시: GitHub Actions

```yaml
on:
  push:
    branches: [main]
    paths-ignore:
      - 'CHANGELOG.md'
      - 'package.json'

jobs:
  release:
    - name: Create Release PR
      run: pnpm changeset version
    - name: Publish to npm
      run: pnpm changeset publish
```

---

## 번들 사이즈 비교

```
목표:  ▮ 300KB

현실:  ▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮ 20MB
       ▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮
       ▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮▮

비율: 1 : 66
```

---

## pnpm pack 테스트 흐름

```bash
# 1. 디자인 시스템 패키지에서
pnpm pack
# → design-system-1.0.0.tgz 생성

# 2. 다른 서비스에서
pnpm install ../design-system/design-system-1.0.0.tgz

# 3. 빠른 피드백 루프
# 수정 → pack → 재설치 → 테스트
```

---

## CSS 충돌 Before/After

### Before (깨진 상태)
```css
/* 기존 CSS */
.button {
  background: red !important;
  padding: 10px !important;
}
/* 우리 스타일이 전부 무시됨 */
```

### After (@layer 적용)
```css
@layer legacy, design-system;

@layer legacy {
  .button { background: red; }
}

@layer design-system {
  .button { background: blue; }
  /* 이제 제대로 적용됨! */
}
```

---

## 참고 자료

- 원본 글: [링크]
- GitHub Repository: [링크]
- 질문/피드백: [이메일]

---